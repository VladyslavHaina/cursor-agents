---
description: "Networking standards (segmentation, egress control, SG/NACL hygiene)"
globs:
  - "**/network/**"
  - "**/networking/**"
  - "**/vpc/**"
  - "**/vpn/**"
  - "**/subnet/**"
  - "**/route/**"
  - "**/firewall/**"
  - "**/*network*.tf"
  - "**/*vpc*.tf"
  - "**/*subnet*.tf"
  - "**/*route*.tf"
  - "**/*security_group*.tf"
  - "**/*nacl*.tf"
  - "**/*waf*.tf"
alwaysApply: false
---

## Networking

- Default to **private** networking:
  - Private subnets for workloads; public subnets only for edge components.
  - Minimize inbound exposure; prefer ALB/NLB + WAF where appropriate.

- Connectivity intent (make it auditable):
  - Document allowed flows with a small table (source → destination → port/proto → enforcement).
  - Prefer identity-based rules (SG→SG, prefix lists, label selectors) over broad CIDRs.

- Segmentation:
  - Separate tiers (edge/app/data) using subnets + security groups.
  - Separate environments (dev/stg/prod) with clear boundaries.

- Security groups / firewall rules:
  - Avoid `0.0.0.0/0` inbound unless explicitly required and justified.
  - Constrain egress where practical (destinations/ports).
  - Prefer referencing security groups / prefix lists over broad CIDRs.

- Routing:
  - Keep route tables explicit and readable.
  - Document non-obvious routes (peering/TGW/VPN/egress-only paths).

- Observability and auditability:
  - Enable flow logs where needed; ensure log retention meets requirements.
  - Make it easy to answer: “what can talk to what, and why?”

- Verification:
  - Include at least one positive connectivity test (allowed path) and one negative test (disallowed path) when tightening rules.
